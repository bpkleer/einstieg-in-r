---
title: "naniar & UpSetR"  # Titel der Seite
weight: 204  # Individuelles Gewicht 
menuTitle: "naniar & UpSetR" # Falls Titel zulang ist, hier Kurztitel
tags: ["ggplot", "Missing values", "advanced"]  # Tags hiereinsetzen; Kurzwort, was auf der Seite passsiert
---



<p>{{% buttonGit href="https://gitlab.ub.uni-giessen.de/methoden-politik/einstieg-in-r/issues/new?issue[title]=" icon="fas fa-bug" %}} {{% /buttonGit %}}</p>
<p>{{% button href="https://twitter.com/intent/tweet" icon="fab fa-twitter" %}} {{% /button %}}</p>
<p>{{% buttonGit href="https://www.facebook.com/sharer/sharer.php?u=" icon="fab fa-facebook" %}} {{% /buttonGit %}}</p>
<p>Mit dem Paket <code>naniar</code> sind die oben dargestellten Schritte viel schneller und leichter darzustellen. Das Paket schafft dabei auch immer einen <code>ggplot</code>, so dass die oben gelernten Anpassungen auch hier möglich sind. Zuerst nutzen wir Funktionen, um uns Tabellen mithilfe von <code>naniar</code> ausgeben zu lassen. Die Erste ist die Funktion <code>miss_var_summary()</code>, die uns die absolute und relative Häufigkeit von <em>missings</em> in den Variablen ausgibt.</p>
<pre class="r"><code>pss %&gt;%
  miss_var_summary()</code></pre>
<pre><code>## # A tibble: 14 × 3
##    variable n_miss pct_miss
##    &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1 edu         352     7.04
##  2 agea        157     3.14
##  3 stfdem       95     1.9 
##  4 trstprl      35     0.7 
##  5 trstprt      17     0.34
##  6 trstlgl      12     0.24
##  7 trstplt      11     0.22
##  8 lrscale       7     0.14
##  9 stfeco        6     0.12
## 10 idno          0     0   
## 11 district      0     0   
## 12 gndr          0     0   
## 13 wkhtot        0     0   
## 14 income        0     0</code></pre>
<p>Dies können wir auch gruppieren:</p>
<pre class="r"><code>pss %&gt;% 
  group_by(district) %&gt;% 
  miss_var_summary()</code></pre>
<pre><code>## # A tibble: 65 × 4
## # Groups:   district [5]
##    district   variable n_miss pct_miss
##    &lt;fct&gt;      &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;
##  1 Distrikt 1 edu          30      3  
##  2 Distrikt 1 stfdem       16      1.6
##  3 Distrikt 1 trstprl       8      0.8
##  4 Distrikt 1 trstprt       4      0.4
##  5 Distrikt 1 lrscale       2      0.2
##  6 Distrikt 1 trstlgl       1      0.1
##  7 Distrikt 1 idno          0      0  
##  8 Distrikt 1 gndr          0      0  
##  9 Distrikt 1 agea          0      0  
## 10 Distrikt 1 wkhtot        0      0  
## # ℹ 55 more rows</code></pre>
<p>Zuerst können wir uns eine Verteilung der <em>missings</em> im Datensatz ausgeben lassen. Die Funktion <code>gg_miss_var_cumsum()</code> gibt uns die kumulierte Summe der <em>missings</em> pro Variable aus. Hieran kann man also ablesen, wie sich die <em>missings</em> auf die Variablen verteilen.</p>
<pre class="r"><code>gg_miss_var_cumsum(pss)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/naniar0-1.png" width="672" /></p>
<p>Die Funktion <code>vis_miss()</code> visualisiert die <em>missings</em> eines gesamten Datensatzes (außer wir grenzen ein).</p>
<pre class="r"><code>vis_miss(pss)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/naniar1-1.png" width="672" /></p>
<p>Eine weitere ansprechende Alternative ist die Funktion <code>gg_miss_upset()</code> aus dem Paket <code>naniar</code>. Hierbei werden auch die Häufigkeiten der Kombination der <em>missings</em> zwischen den Variablen angezeigt. Aber auch dies wird bei allzu großen Datensätzen schnell unübersichtlich. Für Teilbereich kann das aber aufschlussreich sein (z.B. wenn man prüfen möchte, ob Personen nur Teile einer Itembatterie oder die Itembatterie komplett nicht beantwortet haben).</p>
<pre class="r"><code>gg_miss_upset(pss)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/naniar2-1.png" width="672" /></p>
<p>In der Grafik sieht man, dass die vier Variablen <code>trstprt</code>, <code>trtprl</code>, <code>stfdem</code> und <code>agea</code> <code>edu</code> haben. Insgesamt gibt es folgende Kombinationen:</p>
<ul>
<li>311 Fälle, die in <code>edu</code> <code>NA</code> haben,</li>
<li>148 Fälle, die in <code>agea</code> <code>NA</code> haben,</li>
<li>82 Fälle, die in <code>stfdem</code> <code>NA</code> haben,</li>
<li>30 Fälle, die in <code>trstprl</code> <code>NA</code> haben,</li>
<li>13 Fälle, die in <code>trstprt</code> haben,</li>
<li>9 Fälle, die in <code>stfdem</code> und <code>edu</code> <code>NA</code> haben,</li>
<li>5 Fälle, die in <code>agea</code> und <code>edy</code> <code>NA</code> haben,</li>
<li>4 Fälle, die in <code>trstprl</code> und <code>edu</code> <code>NA</code> haben,</li>
<li>3 Fälle, die in <code>stfdem</code> und <code>agea</code> <code>NA</code> haben,</li>
<li>3 Fälle, die in <code>trstprt</code> und <code>edu</code> <code>NA</code> haben,</li>
<li>1 Fälle, die in <code>trstprl</code> und <code>stfdem</code> <code>NA</code> haben,</li>
<li>1 Fälle, die in <code>trstprt</code> und <code>agea</code> <code>NA</code> haben,</li>
</ul>
<p>Insgesamt gilt, dass die maximale Anzahl an Kombinationen wie folgt berechnet wird: <span class="math inline">\(2^{Anzahl Variable} - 1\)</span>. In diesem Fall wären es 31 mögliche Kombinationen, angezeigt werden aber nur 12. Warum?</p>
<p>Daneben können <em>missings</em> zweier Variablen auch über die Funktion <code>geom_miss_point()</code> ganz leicht in einem <code>ggplot</code> dargestellt werden:</p>
<pre class="r"><code>ggplot(
  pss,
  aes(
    x = district,
    y = agea
  )
) +
  geom_miss_point() </code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/missValggplot-1.png" width="672" /></p>
<p>So kann man ganz leicht sehen, ob die <em>missings</em> sich eventuell bei einer bestimmten Kombination häufen.</p>
<p>Alternativ kann man auch noch die Funktionen <code>gg_miss_var()</code> und <code>gg_miss_fct()</code> nutzen.</p>
<p>Mit der Funktion <code>gg_miss_var()</code> wird die Anzahl der <em>missings</em> dargestellt. Mit dem Argument <code>facet</code> kann man dies auch auf einzelne Ausprägungen runterbrechen. So kann man sehen, ob evtl. eine Gruppe deutlich mehr <em>missings</em> aufweist, als eine andere Gruppe.</p>
<pre class="r"><code>gg_miss_var(
  pss,
  facet = district
)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/ggmissvar-1.png" width="672" />
Mit der Funktion <code>gg_miss_fct()</code> können <em>missings</em> visuell sehr schön aufbereitet werden.</p>
<pre class="r"><code>gg_miss_fct(
  x = pss, 
  fct = district
)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/ggmissfct-1.png" width="672" />
Auch das kann man sich wieder nach Ausprägungen auf einer weiteren Variable ausgeben lassen, um zu sehen, ob es starke Gruppenunterschiede gibt:</p>
<pre class="r"><code>gg_miss_fct(
  x = pss, 
  fct = district
) + 
  labs(title = &quot;NA in PSS nach Distrikt&quot;)</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-4_files/figure-html/ggmissfct2-1.png" width="672" /></p>
<p>Das war’s zu <em>missing values</em>!</p>
