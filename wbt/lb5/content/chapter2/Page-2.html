---
title: "Annotations"  # Titel der Seite
weight: 202  # Individuelles Gewicht 
menuTitle: "Annotations" # Falls Titel zulang ist, hier Kurztitel
tags: ["ggplot", "annotation", "advanced"]  # Tags hiereinsetzen; Kurzwort, was auf der Seite passsiert
---



<p>{{% buttonGit href="https://gitlab.ub.uni-giessen.de/methoden-politik/einstieg-in-r/issues/new?issue[title]=" icon="fas fa-bug" %}} {{% /buttonGit %}}</p>
<p>{{% button href="https://twitter.com/intent/tweet" icon="fab fa-twitter" %}} {{% /button %}}</p>
<p>{{% buttonGit href="https://www.facebook.com/sharer/sharer.php?u=" icon="fab fa-facebook" %}} {{% /buttonGit %}}</p>
<p>Neben den ganzen Spielereien möchte man manchmal auch einzelne Bereiche einer Grafik besonders hervorheben oder aber zum Beispiel Beschriftungen der Fälle hinzufügen (bei kleinem n).</p>
<p>Hierzu gibt es die Funktionen <code>geom_text()</code> und <code>annotate()</code>, die mit <code>ggplot</code> genutzt werden können. Dazu nehmen wir wieder das Scatterplot vom Beginn, begrenzen aber diesmal die Anzahl auf 15, damit wir eine klare Darstellung bekommen.</p>
<p>{{% notice warning %}}
<code>geom_jitter()</code> kann nicht genutzt werden, da die Datenbeschriftungen am Datenpunkt und nicht am gejitterten Datenpunkt auftauchen!
{{% /notice %}}</p>
<pre class="r"><code>scatter2 &lt;- ggplot(
  pss[1:15,], 
  aes(
    stfeco, 
    stfdem
  )
) +  
  geom_point(col = &quot;blue&quot;) +
  scale_x_continuous(
    breaks = seq(
      0, 
      10,
      1
    )
  ) +
  scale_y_continuous(
    breaks = seq(
      0, 
      10, 
      1
    )
  )

scatter2</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/base-scatter2-1.png" width="672" />
Mit der Funktion <code>geom_text()</code> kann man den Datenpunkten Beschriftungen hinzufügen. So zum Beispiel die Zeilennummer oder die ID-Variable. Wir machen letzteres, da sich die Zeilennummer bei Sortierungen ändern kann und somit nicht eindeutig ist. Daher fügen wir jetzt mit der Funktion in <code>aes</code> ein <code>label</code> hinzu (<code>idno</code>).</p>
<pre class="r"><code>scatter2 +
  geom_text(
    aes(label = idno)
  )</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/addtext-1.png" width="672" />
Innerhalb von <code>geom_text()</code> kann man nun weitere Einstellungen vornehmen. Ein paar davon kennen wir schon, zwei weitere wichtige sind <code>nudge_y</code> und <code>nudge_x</code>, die den Schriftstart auf der jeweiligen Achse verschieben.</p>
<pre class="r"><code>scatter2 +
  geom_text(
    aes(label = idno),
    size = 2, 
    nudge_y = -.15
  )</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/addtext2-1.png" width="672" /></p>
<p>Wenn man nun trotzdem alle Datenpunkte abbilden möchte und nur spezifische Datenpunkte hervorheben möchte, ist dies ganz leicht möglich: Wir möchten nur die ersten zehn Fälle anzeigen und begrenzen daher die Daten in <code>geom_text()</code>. Dies ist auch über <code>subset()</code> mit mehreren Verknüpfungen möglich.</p>
<pre class="r"><code>ggplot(
  pss, 
  aes(
    stfeco, 
    stfdem
  )
) +  
  geom_point(
    alpha = .2, 
    col = &quot;blue&quot;
  ) +
  scale_x_continuous(
    breaks = seq(
      0, 
      10,
      1
    )
  ) +
  scale_y_continuous(
    breaks = seq(
      0, 
      10,
      1
    )
  ) +
  geom_text(
    aes(label = idno), 
    data = pss[1:10,]
  )</code></pre>
<pre><code>## Warning: Removed 96 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/addtext3-1.png" width="672" /></p>
<p>Weitaus größere Möglichkeiten bietet <code>annotate()</code>. Mit dieser können nicht nur Beschriftungen, sondern auch bestimmte Bereiche innerhalb eines Plots hervorgehoben werden. Nehmen wir wieder das gejitterte Plot und markieren einen bestimmten Bereich im Plot:</p>
<pre class="r"><code>scatter2 +
  annotate(
    &quot;rect&quot;, 
    xmin = 6.5, # this corresponds to the axis scale!
    xmax = 8.5,
    ymin = 7.5,
    ymax = 10.5,
    colour = &quot;darkgreen&quot;,
    fill = &quot;lightgreen&quot;
  )</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/annotated-1.png" width="672" /></p>
<p>Der Nachteil wird direkt ersichtlich! Da <code>ggplot</code> über Layer angesprochen wird, muss der <code>annotate()</code>-Layer vor dem <code>geom_jitter()</code>-Layer stehen. Oder wir fügen <code>alpha</code> hinzu, um die Sichtbarkeit zu verändrn:</p>
<pre class="r"><code>scatter2 +
  annotate(
    &quot;rect&quot;, 
    xmin = 6.5,  
    xmax = 8.5,
    ymin = 7.5,
    ymax = 10.5,
    colour = &quot;darkgreen&quot;,
    fill = &quot;lightgreen&quot;,
    alpha = .1
  )</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/annotated2-1.png" width="672" />
Jetzt möchten wir in der Grafik noch eine Beschriftung hinzufügen, damit der Leser:in klar wird, welchen Bereich wir hier markiert haben:</p>
<pre class="r"><code>scatter2 +
  annotate(
    &quot;rect&quot;, 
    xmin = 6.5,  
    xmax = 8.5,
    ymin = 7.5,
    ymax = 10.5,
    colour = &quot;darkgreen&quot;,
    fill = &quot;lightgreen&quot;,
    alpha = .1
  ) +
  annotate(
    &quot;text&quot;, 
    x = 4, 
    y = 9, 
    label = &quot;highlighted area&quot;, # with \n you get a new line
    colour = &quot;darkgreen&quot;
  ) </code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/annotated3-1.png" width="672" /></p>
<p>Als weitere Möglichkeit bietet <code>annotate()</code> die Möglichkeit Linien zu erstellen, so dass wir unseren Text auf das Feld zeigen lassen können:</p>
<pre class="r"><code>scatter2 +
  annotate(
    &quot;rect&quot;, 
    xmin = 6.5, 
    xmax = 8.5,
    ymin = 7.5,
    ymax = 10.5,
    colour = &quot;darkgreen&quot;,
    fill = &quot;lightgreen&quot;,
    alpha = .1
  ) +
  annotate(
    &quot;text&quot;, 
    x = 4, 
    y = 9, 
    label = &quot;highlighted area&quot;, # with \n you get a new line
    color = &quot;darkgreen&quot;
  ) +
  annotate(
    &quot;segment&quot;, 
    x = 4.6,
    xend = 6.5, 
    y = 9, 
    yend = 9,
    color = &quot;darkgreen&quot;,
    arrow = arrow()
  )</code></pre>
<p><img src="/statsplus/lb5/chapter2/Page-2_files/figure-html/annotated4-1.png" width="672" /></p>
<p>Im letzten Schritt lernst du noch die Darstellung von <em>missing values</em> kennen!</p>
