---
title: "Annahme 6: Einflussreiche Fälle"  # Titel der Seite
weight: 307  # Individuelles Gewicht 
menuTitle: "Einflussreiche Fälle" # Falls Titel zulang ist, hier Kurztitel
tags: ["regressionsdiagnostik", "einflussreiche fälle"]  # Tags hiereinsetzen; Kurzwort, was auf der Seite passsiert
---

<script src="/statsplus/lb4/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/statsplus/lb4/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<p>{{% buttonGit href="https://gitlab.ub.uni-giessen.de/methoden-politik/einstieg-in-r/issues/new?issue[title]=" icon="fas fa-bug" %}} {{% /buttonGit %}}</p>
<p>{{% buttonGit href="mailto:?subject=Schau%20dir%20das%20mal%20an%3A%20" icon="fas fa-paper-plane" %}} {{% /buttonGit %}}</p>
<p>{{% buttonGit href="https://t.me/share/url?url=" icon="fab fa-telegram" %}} {{% /buttonGit %}}</p>
<p>{{% buttonGit href="https://api.whatsapp.com/send?text=" icon="fab fa-whatsapp" %}} {{% /buttonGit %}}</p>
<p>{{% buttonGit href="https://twitter.com/share?url=" icon="fab fa-twitter" %}} {{% /buttonGit %}}</p>
<p>{{% buttonGit href="https://www.facebook.com/sharer/sharer.php?u=" icon="fab fa-facebook" %}} {{% /buttonGit %}}</p>
<p>Um auf einflussreiche Fälle zu prüfen, nutzen wir wieder die Resdiuen. Hier sind zwei Werte relevant: <strong>Leverage</strong> und <strong>Cook’s D(istance)</strong>. Da <strong>Cook’s D(istance)</strong> in Teilen auf dem <strong>leverage</strong> beruht, fokussieren wir direkt <strong>Cook’s D</strong>.</p>
<p>{{% tabs %}}
{{% tab name="Leverage" %}}</p>
<ul>
<li><p>Ist die partielle Ableitung des geschätzten <span class="math inline">\(i\)</span>-ten Wert der abhängigen Variable <span class="math inline">\(\hat{y_i}\)</span> in Abhängigkeit des gemessenen <span class="math inline">\(i\)</span>-ten Wert der abhängigen Variable <span class="math inline">\(y_i\)</span></p></li>
<li><p>Der Grad, in dem der <span class="math inline">\(i\)</span>-te gemessene Wert den <span class="math inline">\(i\)</span>-ten gefitteten Wert beeinflusst wird</p></li>
<li><p>“Ungewöhnlichkeit” der <span class="math inline">\(x\)</span>’s</p></li>
<li><p><span class="math inline">\(h_{ii} = \frac{\partial \hat{y_i}}{\partial y_i}\)</span></p></li>
<li><p>Fall gilt als einflussreich, falls <span class="math inline">\(h_{ii} &gt; .2\)</span>
{{% /tab %}}
{{% tab name="Cook’s D" %}}</p></li>
<li><p>Ist die Distanz der Veränderung, die ein geschätzter Wert innerhalb der Konfidenz-Ellipse bewegt, die die Region plausibler Werte für den Parameter annimmt</p></li>
<li><p>Misst den Einfluss (wie stark ein Fall das Regressionsmodell ändert)</p></li>
<li><p><span class="math inline">\(D_i = \frac{ \sum_{j=1}^n (\hat{y}_j - \hat{y}_{j(i)})}{p * s^2}\)</span>, wobei <span class="math inline">\(p\)</span> Anzahl der Parameter ist</p></li>
<li><p>Klassifiziert als einflussreich, wenn <span class="math inline">\(D_i &gt; \bar{D} *3\)</span>
{{% /tab %}}
{{% /tabs %}}</p></li>
</ul>
<p>Zuerst können wir einfach <strong>Cook’s D</strong> plotten. Dazu nutzt du wieder die Funktion <code>plot()</code>, gibst das Regressionsmodell an und setzt im zweiten Argument den Wert <code>4</code>:</p>
<pre class="r"><code>plot(
  olsModel2,
  4
)</code></pre>
<p><img src="/statsplus/lb4/chapter3/page-7_files/figure-html/cooksd-1.png" width="672" /></p>
<p><strong>Grenzwerte</strong>:</p>
<p><span class="math inline">\(D_i &lt; 1\)</span>: keine einzige Beobachtung</p>
<p><span class="math inline">\(\frac{4}{4890} \approx 0.0008179959\)</span>: viele Fälle</p>
<p><span class="math inline">\(\bar{D} * 3 \approx 0.0005895857\)</span>: viele Fälle</p>
<p>Wir können auch direkt <strong>Cook’s D</strong> gegen das <strong>leverage</strong> plotten und Linien für die Grenzwerte einziehen:</p>
<pre class="r"><code>plot(
  olsModel2, 
  6
)

abline(
  h = 3 * mean(cooks.distance(olsModel2), na.rm = TRUE), 
  col = &quot;chartreuse4&quot;, 
  lty = 6,  # Grenze Cook&#39;s D
  lwd = 2
)

abline(
  v = 2 * (2 + 1) / 2393, 
  col = &quot;chartreuse4&quot;, 
  lty = 6,  # Grenze leverage
  lwd = 2
) </code></pre>
<p>Um nun zu prüfen, ob diese theoretisch potentiell einflussreichen Fälle wirklich einflussreich sind, berechnen wir das Modell erneut unter Ausschluss dieser Beobachtungen.</p>
<p>Dafür benötigen wir einen Datensatz, der dieselbe Länge hat wie unsere Modellschätzung:</p>
<pre class="r"><code>nobs(olsModel2)</code></pre>
<pre><code>## [1] 4893</code></pre>
<pre class="r"><code>ccol &lt;- c(
  &quot;stfdem&quot;,
  &quot;stfeco&quot;,
  &quot;trstlgl&quot;
)   

pss2 &lt;- pss[complete.cases(pss[,ccol]),]

dim(pss2)</code></pre>
<pre><code>## [1] 4893   14</code></pre>
<p>Nun können wir die Werte des <strong>leverage</strong> (<em>hat values</em>) und <strong>Cook’s D</strong> dem Datensatz hinzufügen.</p>
<pre class="r"><code>pss2$hats &lt;- hatvalues(olsModel2)    

pss2$cooksd &lt;- cooks.distance(olsModel2)  </code></pre>
<p>Alles, was jetzt folgt, benötigt ein tieferes Verständnis, und insbesonder das Verständnis für Schleifen und <em>if</em>-Bedingungen aus dem <a href="https://lehre.bpkleer.de/statsplus/lb2/chapter3/">Lernblock 2</a>. <strong>Aber</strong> wie geschrieben, ist dieses Kapitel extra und wird nicht Teil der verpflichtenden Lab-Übung sein.</p>
<p>Um nun die potentiell einflussreichen Fälle auszuschließen, benötigen wir einen Dummy, der uns anzeigt, ob der Fall nach den Kriterien einflussreich ist (<span class="math inline">\(1\)</span>) oder nicht (<span class="math inline">\(0\)</span>): In der Schleife prüfen wir zuerst, ob der jeweilige Wert des Falles über dem Grenzwert ist. Wenn ja, bekommt für das <em>leverage</em> die Variable <code>leverage</code> den Wert 1 bzw. für Cook’s D die Variable <code>influence</code>.</p>
<pre class="r"><code>for (i in 1:dim(pss2)[1]) {   
if (pss2$hats[i] &gt; (2*(2+1)/dim(pss2)[1])) {
   pss2$leverage[i] = 1
} else {
   pss2$leverage[i] = 0
}
}

for (i in 1:dim(pss2)[1]) {
   if (pss2$cooksd[i] &gt; (3*mean(pss2$cooksd))) {
      pss2$influence[i] = 1
   } else {
      pss2$influence[i] = 0
   }
}</code></pre>
<p>Nun können wir das Modell mit dem verkleinerten Datensatz erneut rechnen: Hierbei beschränken wir den Datensatz auf die Fälle, die jeweils in den neu geschaffenen Variablen <code>leverage</code> und <code>influence</code> den Wert <code>0</code> haben, also nicht einflussreich sind.</p>
<pre class="r"><code>olsModel2Re &lt;- lm(
  stfdem ~ 1 + stfeco + trstlgl,  
  data = pss2[pss2$leverage==0 &amp; pss2$influence==0,]
)</code></pre>
<p>Um herauszufinden, wie viele Fälle wir ausgeschlossen haben, kannst du folgende einfache Subtraktion machen:</p>
<pre class="r"><code>nobs(olsModel2Re) - nobs(olsModel2)</code></pre>
<pre><code>## [1] -736</code></pre>
<p>Es wurden also 736 Fälle ausgeschlossen. Eine ganze Menge!</p>
<p>Schauen wir uns das Ergebnis des Re-definierten Modells mit <code>summary()</code> an:
<strong>Re-definiertes Modelll</strong></p>
<pre class="r"><code>summary(olsModel2Re)</code></pre>
<pre><code>## 
## Call:
## lm(formula = stfdem ~ 1 + stfeco + trstlgl, data = pss2[pss2$leverage == 
##     0 &amp; pss2$influence == 0, ])
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.8164 -0.9224  0.1008  1.1405  4.2267 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.34644    0.10316   3.358 0.000791 ***
## stfeco       0.93705    0.01508  62.147  &lt; 2e-16 ***
## trstlgl     -0.04306    0.01494  -2.883 0.003959 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.536 on 4154 degrees of freedom
## Multiple R-squared:  0.482,	Adjusted R-squared:  0.4818 
## F-statistic:  1933 on 2 and 4154 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Doch weicht das nun ab vom alten Modell? Dazu nehmen wir einfach die Funktion <code>modelsummary()</code>, die wir schon kennengelernt haben. Denn in einer Tabelle können wir die Werte besser vergleichen. Wichtig ist hierbei zu prüfen, ob sich die Standardfehler bzw. die Koeffizienten ändern.</p>
<pre class="r"><code>modelsummary(
  list(
    olsModel2, 
    olsModel2Re
  ),
  stars = TRUE
)</code></pre>
<table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
 (1)
</th>
<th style="text-align:center;">
  (2)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
0.677***
</td>
<td style="text-align:center;">
0.346***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.093)
</td>
<td style="text-align:center;">
(0.103)
</td>
</tr>
<tr>
<td style="text-align:left;">
stfeco
</td>
<td style="text-align:center;">
0.874***
</td>
<td style="text-align:center;">
0.937***
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.014)
</td>
<td style="text-align:center;">
(0.015)
</td>
</tr>
<tr>
<td style="text-align:left;">
trstlgl
</td>
<td style="text-align:center;">
−0.042**
</td>
<td style="text-align:center;">
−0.043**
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1.5px">
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
(0.013)
</td>
<td style="text-align:center;box-shadow: 0px 1.5px">
(0.015)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
4893
</td>
<td style="text-align:center;">
4157
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.460
</td>
<td style="text-align:center;">
0.482
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.460
</td>
<td style="text-align:center;">
0.482
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
19265.4
</td>
<td style="text-align:center;">
15372.7
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
19291.4
</td>
<td style="text-align:center;">
15398.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
−9628.717
</td>
<td style="text-align:center;">
−7682.341
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
2081.151
</td>
<td style="text-align:center;">
1932.889
</td>
</tr>
<tr>
<td style="text-align:left;">
RMSE
</td>
<td style="text-align:center;">
1.73
</td>
<td style="text-align:center;">
1.54
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001
</td>
</tr>
</tfoot>
</table>
<p><span class="math inline">\(\Rightarrow\)</span> Du siehst, dass sich der Koeffizient für den <em>intercept</em> als auch für <code>stfeco</code> ändert. Der <em>intercept</em> wird kleiner, der Effekt von <code>stfdem</code> dagegen größer. Die Standardfehler (Werte in Klammern) ändern sich dagegen nicht.</p>
<p>Wenn wir große Änderungen erkennen, müssen die gefilterten Fälle genauer inspiziert werden. Denn wir können Fälle nicht einfach aufgrund mathematischer Bedingungen exkludieren.</p>
<p>Um herauszufinden, um welche Fälle es sich handelt, kann man wieder eine Schleife programmieren:</p>
<pre class="r"><code>levInfluential &lt;- c()
cookInfluential &lt;- c()
allInfluential &lt;- c()

# nur für leverage
for (i in 1:dim(pss2)[1]) {
  if (pss2$leverage[i] == 1) {
    levInfluential &lt;- c(levInfluential, pss2$idno[i])
  }
}

# nur für Cook&#39;s D
for (i in 1:dim(pss2)[1]) {
  if (pss2$influence[i] == 1) {
    cookInfluential &lt;- c(cookInfluential, pss2$idno[i])
  }
}

# für beides
for (i in 1:dim(pss2)[1]) {
  if (pss2$leverage[i] == 1 &amp; pss2$influence[i] == 1) {
    allInfluential &lt;- c(allInfluential, pss2$idno[i])
  }
}</code></pre>
<p>Als Ergebnis bekommst du drei Vektoren, die jeweils die einflussreichen Fälle beinhalten:</p>
<pre class="r"><code>levInfluential</code></pre>
<pre><code>##   [1] 10008 10018 10023 10034 10041 10081 10083 10094 10116 10125 10147 10180
##  [13] 10205 10216 10220 10239 10240 10255 10259 10266 10268 10274 10278 10281
##  [25] 10296 10302 10305 10316 10348 10353 10364 10370 10389 10398 10418 10423
##  [37] 10432 10446 10466 10476 10491 10494 10517 10520 10530 10536 10547 10548
##  [49] 10559 10568 10571 10587 10592 10612 10637 10642 10654 10662 10668 10688
##  [61] 10692 10705 10706 10707 10730 10772 10773 10777 10781 10797 10812 10825
##  [73] 10831 10835 10841 10846 10865 10866 10888 10898 10931 10934 10975 10989
##  [85] 10995 20011 20014 20055 20058 20071 20089 20092 20103 20122 20142 20147
##  [97] 20149 20158 20159 20172 20179 20208 20231 20242 20255 20256 20263 20267
## [109] 20279 20318 20329 20339 20352 20371 20373 20381 20390 20398 20400 20402
## [121] 20407 20414 20420 20459 20462 20487 20500 20514 20539 20552 20555 20556
## [133] 20563 20588 20591 20600 20632 20633 20639 20642 20648 20651 20668 20678
## [145] 20684 20705 20708 20743 20744 20745 20763 20767 20776 20777 20780 20797
## [157] 20817 20822 20839 20855 20866 20876 20882 20896 20916 20917 20938 20944
## [169] 20969 20992 30005 30022 30043 30061 30068 30081 30083 30171 30184 30195
## [181] 30201 30222 30232 30244 30251 30252 30287 30295 30299 30310 30314 30332
## [193] 30341 30348 30360 30366 30375 30379 30383 30401 30402 30412 30430 30434
## [205] 30456 30482 30493 30498 30500 30501 30523 30533 30537 30547 30558 30564
## [217] 30601 30644 30664 30669 30683 30698 30715 30718 30731 30743 30754 30764
## [229] 30771 30773 30775 30782 30788 30813 30833 30856 30859 30863 30864 30866
## [241] 30874 30880 30886 30901 30908 30913 30927 40016 40037 40101 40104 40113
## [253] 40124 40137 40160 40163 40171 40173 40202 40207 40213 40221 40230 40233
## [265] 40248 40255 40270 40291 40305 40313 40314 40317 40327 40336 40357 40365
## [277] 40367 40376 40388 40416 40429 40437 40441 40447 40457 40481 40490 40525
## [289] 40528 40530 40541 40552 40571 40599 40607 40618 40619 40632 40652 40671
## [301] 40690 40694 40709 40712 40718 40722 40723 40726 40728 40733 40739 40742
## [313] 40745 40774 40794 40803 40809 40849 40850 40855 40862 40877 40890 40892
## [325] 40921 40930 40972 40978 40982 40994 40995 50000 50009 50033 50046 50053
## [337] 50066 50089 50092 50103 50105 50114 50153 50170 50183 50192 50198 50199
## [349] 50207 50210 50212 50220 50230 50236 50244 50252 50254 50264 50265 50273
## [361] 50303 50309 50320 50324 50328 50331 50352 50382 50387 50394 50413 50414
## [373] 50415 50423 50441 50444 50452 50456 50465 50468 50469 50483 50486 50492
## [385] 50502 50505 50507 50511 50513 50541 50544 50556 50574 50576 50584 50586
## [397] 50590 50596 50617 50623 50631 50639 50641 50643 50682 50686 50691 50694
## [409] 50697 50699 50710 50720 50750 50763 50774 50782 50788 50793 50807 50826
## [421] 50833 50834 50860 50882 50902 50921 50923 50928 50933 50954 50979 50986
## [433] 50988 50998</code></pre>
<pre class="r"><code>cookInfluential</code></pre>
<pre><code>##   [1] 10007 10008 10010 10024 10050 10054 10068 10072 10076 10088 10094 10100
##  [13] 10116 10119 10125 10135 10138 10146 10147 10150 10152 10216 10248 10255
##  [25] 10257 10278 10291 10316 10346 10361 10395 10398 10410 10413 10432 10434
##  [37] 10450 10459 10460 10475 10483 10495 10497 10530 10544 10546 10559 10585
##  [49] 10613 10617 10620 10624 10633 10638 10655 10662 10677 10679 10680 10682
##  [61] 10708 10709 10720 10726 10738 10759 10771 10777 10781 10782 10787 10789
##  [73] 10790 10794 10798 10807 10812 10817 10820 10821 10879 10924 10944 10952
##  [85] 10989 10998 10999 20054 20058 20063 20075 20084 20103 20118 20147 20170
##  [97] 20172 20191 20228 20248 20255 20257 20263 20267 20301 20328 20329 20335
## [109] 20363 20365 20372 20373 20381 20390 20398 20400 20417 20447 20462 20465
## [121] 20472 20487 20494 20512 20513 20514 20530 20535 20579 20580 20600 20604
## [133] 20623 20636 20637 20639 20659 20668 20684 20707 20732 20736 20746 20748
## [145] 20763 20775 20776 20855 20860 20863 20864 20873 20907 20909 20916 20925
## [157] 20932 20950 20974 20975 20984 20998 30014 30052 30059 30072 30097 30118
## [169] 30122 30165 30184 30188 30200 30207 30210 30218 30232 30240 30249 30251
## [181] 30253 30254 30255 30292 30304 30312 30315 30321 30322 30336 30337 30348
## [193] 30370 30376 30383 30386 30412 30420 30428 30430 30445 30474 30479 30482
## [205] 30484 30485 30486 30501 30530 30537 30546 30547 30558 30564 30613 30614
## [217] 30621 30628 30638 30683 30692 30694 30695 30697 30701 30725 30731 30754
## [229] 30763 30768 30788 30811 30812 30813 30820 30831 30856 30867 30877 30898
## [241] 30910 30914 30928 30939 30956 30958 30959 30970 40037 40050 40052 40056
## [253] 40059 40067 40073 40089 40094 40113 40116 40121 40162 40172 40173 40186
## [265] 40192 40193 40205 40212 40213 40215 40218 40220 40244 40261 40278 40284
## [277] 40291 40297 40301 40305 40320 40328 40329 40331 40336 40355 40363 40369
## [289] 40376 40377 40401 40424 40440 40443 40447 40450 40451 40452 40487 40517
## [301] 40521 40525 40559 40568 40590 40607 40618 40638 40658 40672 40690 40726
## [313] 40731 40733 40739 40745 40770 40776 40779 40796 40803 40813 40814 40825
## [325] 40834 40850 40855 40868 40895 40927 40954 40974 40976 40993 50007 50034
## [337] 50046 50072 50085 50092 50096 50128 50171 50191 50207 50210 50224 50246
## [349] 50274 50283 50290 50302 50303 50328 50340 50368 50376 50392 50413 50414
## [361] 50415 50416 50430 50452 50456 50483 50487 50513 50553 50555 50562 50575
## [373] 50587 50591 50596 50609 50621 50623 50639 50640 50648 50649 50652 50669
## [385] 50682 50691 50696 50708 50710 50720 50727 50750 50755 50762 50780 50785
## [397] 50795 50815 50826 50833 50834 50843 50845 50853 50867 50902 50931 50954
## [409] 50982 50986</code></pre>
<pre class="r"><code>allInfluential</code></pre>
<pre><code>##   [1] 10008 10094 10116 10125 10147 10216 10255 10278 10316 10398 10432 10530
##  [13] 10559 10662 10777 10781 10812 10989 20058 20103 20147 20172 20255 20263
##  [25] 20267 20329 20373 20381 20390 20398 20400 20462 20487 20514 20600 20639
##  [37] 20668 20684 20763 20776 20855 20916 30184 30232 30251 30348 30383 30412
##  [49] 30430 30482 30501 30537 30547 30558 30564 30683 30731 30754 30788 30813
##  [61] 30856 40037 40113 40173 40213 40291 40305 40336 40376 40447 40525 40607
##  [73] 40618 40690 40726 40733 40739 40745 40803 40850 40855 50046 50092 50207
##  [85] 50210 50303 50328 50413 50414 50415 50452 50456 50483 50513 50596 50623
##  [97] 50639 50682 50691 50710 50720 50750 50826 50833 50834 50902 50954 50986</code></pre>
<p>Anschließend könntest du dir die Wertepaare auf den Variablen in der Regression pro Fall genauer anschauen!</p>
<p>Das war’s zur Regressionsdiagnostik. In den sechs Schritten kannst du also sichergehen, ob deine Regressionsrechnung nicht aufgrund einer Annahmenverletzung verzerrt ist.</p>
